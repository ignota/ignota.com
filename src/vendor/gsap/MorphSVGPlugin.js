/*!
 * VERSION: 0.8.11
 * DATE: 2018-05-30
 * UPDATES AND DOCS AT: http://greensock.com
 *
 * @license Copyright (c) 2008-2018, GreenSock. All rights reserved.
 * MorphSVGPlugin is a Club GreenSock membership benefit; You must have a valid membership to use
 * this code without violating the terms of use. Visit http://greensock.com/club/ to sign up or get more details.
 * This work is subject to the software agreement that was issued with your membership.
 * 
 * @author: Jack Doyle, jack@greensock.com
 */
import{_gsScope}from"gsap/TweenLite.js";var _DEG2RAD=Math.PI/180,_RAD2DEG=180/Math.PI,_svgPathExp=/[achlmqstvz]|(-?\d*\.?\d*(?:e[\-+]?\d+)?)[0-9]/gi,_numbersExp=/(?:(-|-=|\+=)?\d*\.?\d*(?:e[\-+]?\d+)?)[0-9]/gi,_selectorExp=/(^[#\.][a-z]|[a-y][a-z])/gi,_commands=/[achlmqstvz]/gi,_scientific=/[\+\-]?\d*\.?\d+e[\+\-]?\d+/gi,TweenLite=_gsScope._gsDefine.globals.TweenLite,_log=function(e){_gsScope.console&&console.log(e)},_normalizedArcToBeziers=function(e,t){var r,n,i,o,a,s,l=Math.ceil(Math.abs(t)/90),h=0,g=[];for(e*=_DEG2RAD,r=(t*=_DEG2RAD)/l,n=4/3*Math.sin(r/2)/(1+Math.cos(r/2)),s=0;s<l;s++)i=e+s*r,o=Math.cos(i),a=Math.sin(i),g[h++]=o-n*a,g[h++]=a+n*o,i+=r,o=Math.cos(i),a=Math.sin(i),g[h++]=o+n*a,g[h++]=a-n*o,g[h++]=o,g[h++]=a;return g},_arcToBeziers=function(e,t,r,n,i,o,a,s,l){if(e!==s||t!==l){r=Math.abs(r),n=Math.abs(n);var h=i%360*_DEG2RAD,g=Math.cos(h),u=Math.sin(h),p=(e-s)/2,c=(t-l)/2,f=g*p+u*c,_=-u*p+g*c,d=r*r,v=n*n,z=f*f,b=_*_,M=z/d+b/v;M>1&&(d=(r=Math.sqrt(M)*r)*r,v=(n=Math.sqrt(M)*n)*n);var m=o===a?-1:1,S=(d*v-d*b-v*z)/(d*b+v*z);S<0&&(S=0);var A=m*Math.sqrt(S),P=A*(r*_/n),y=A*(-n*f/r),T=(e+s)/2+(g*P-u*y),x=(t+l)/2+(u*P+g*y),B=(f-P)/r,N=(_-y)/n,D=(-f-P)/r,G=(-_-y)/n,E=Math.sqrt(B*B+N*N),F=B,V=(m=N<0?-1:1)*Math.acos(F/E)*_RAD2DEG;E=Math.sqrt((B*B+N*N)*(D*D+G*G)),F=B*D+N*G;var C=(m=B*G-N*D<0?-1:1)*Math.acos(F/E)*_RAD2DEG;!a&&C>0?C-=360:a&&C<0&&(C+=360);var w,q,L,R=_normalizedArcToBeziers(V%=360,C%=360),Y=g*r,I=u*r,X=u*-n,j=g*n,Q=R.length-2;for(w=0;w<Q;w+=2)q=R[w],L=R[w+1],R[w]=q*Y+L*X+T,R[w+1]=q*I+L*j+x;return R[R.length-2]=s,R[R.length-1]=l,R}},_pathDataToBezier=function(e){var t,r,n,i,o,a,s,l,h,g,u,p,c,f=(e+"").replace(_scientific,function(e){var t=+e;return t<1e-4&&t>-1e-4?0:t}).match(_svgPathExp)||[],_=[],d=0,v=0,z=f.length,b=2,M=0;if(!e||!isNaN(f[0])||isNaN(f[1]))return _log("ERROR: malformed path data: "+e),_;for(t=0;t<z;t++)if(c=o,isNaN(f[t])?a=(o=f[t].toUpperCase())!==f[t]:t--,n=+f[t+1],i=+f[t+2],a&&(n+=d,i+=v),0===t&&(l=n,h=i),"M"===o)s&&s.length<8&&(_.length-=1,b=0),d=l=n,v=h=i,s=[n,i],M+=b,b=2,_.push(s),t+=2,o="L";else if("C"===o)s||(s=[0,0]),s[b++]=n,s[b++]=i,a||(d=v=0),s[b++]=d+1*f[t+3],s[b++]=v+1*f[t+4],s[b++]=d+=1*f[t+5],s[b++]=v+=1*f[t+6],t+=6;else if("S"===o)"C"===c||"S"===c?(g=d-s[b-4],u=v-s[b-3],s[b++]=d+g,s[b++]=v+u):(s[b++]=d,s[b++]=v),s[b++]=n,s[b++]=i,a||(d=v=0),s[b++]=d+=1*f[t+3],s[b++]=v+=1*f[t+4],t+=4;else if("Q"===o)g=n-d,u=i-v,s[b++]=d+2*g/3,s[b++]=v+2*u/3,a||(d=v=0),g=n-(d+=1*f[t+3]),u=i-(v+=1*f[t+4]),s[b++]=d+2*g/3,s[b++]=v+2*u/3,s[b++]=d,s[b++]=v,t+=4;else if("T"===o)g=d-s[b-4],u=v-s[b-3],s[b++]=d+g,s[b++]=v+u,g=d+1.5*g-n,u=v+1.5*u-i,s[b++]=n+2*g/3,s[b++]=i+2*u/3,s[b++]=d=n,s[b++]=v=i,t+=2;else if("H"===o)i=v,s[b++]=d+(n-d)/3,s[b++]=v+(i-v)/3,s[b++]=d+2*(n-d)/3,s[b++]=v+2*(i-v)/3,s[b++]=d=n,s[b++]=i,t+=1;else if("V"===o)i=n,n=d,a&&(i+=v-d),s[b++]=n,s[b++]=v+(i-v)/3,s[b++]=n,s[b++]=v+2*(i-v)/3,s[b++]=n,s[b++]=v=i,t+=1;else if("L"===o||"Z"===o)"Z"===o&&(n=l,i=h,s.closed=!0),("L"===o||Math.abs(d-n)>.5||Math.abs(v-i)>.5)&&(s[b++]=d+(n-d)/3,s[b++]=v+(i-v)/3,s[b++]=d+2*(n-d)/3,s[b++]=v+2*(i-v)/3,s[b++]=n,s[b++]=i,"L"===o&&(t+=2)),d=n,v=i;else if("A"===o){if(p=_arcToBeziers(d,v,1*f[t+1],1*f[t+2],1*f[t+3],1*f[t+4],1*f[t+5],(a?d:0)+1*f[t+6],(a?v:0)+1*f[t+7]))for(r=0;r<p.length;r++)s[b++]=p[r];d=s[b-2],v=s[b-1],t+=7}else _log("Error: malformed path data: "+e);return _.totalPoints=M+b,_},_subdivideBezier=function(e,t){var r,n,i,o,a,s,l,h,g,u,p,c,f,_,d=0,v=e.length,z=t/((v-2)/6);for(f=2;f<v;f+=6)for(d+=z;d>.999999;)r=e[f-2],n=e[f-1],i=e[f],o=e[f+1],a=e[f+2],s=e[f+3],l=e[f+4],h=e[f+5],g=r+(i-r)*(_=1/(Math.floor(d)+1)),g+=((p=i+(a-i)*_)-g)*_,p+=(a+(l-a)*_-p)*_,u=n+(o-n)*_,u+=((c=o+(s-o)*_)-u)*_,c+=(s+(h-s)*_-c)*_,e.splice(f,4,r+(i-r)*_,n+(o-n)*_,g,u,g+(p-g)*_,u+(c-u)*_,p,c,a+(l-a)*_,s+(h-s)*_),f+=6,v+=6,d--;return e},_bezierToPathData=function(e){var t,r,n,i,o="",a=e.length;for(r=0;r<a;r++){for(o+="M"+(i=e[r])[0]+","+i[1]+" C",t=i.length,n=2;n<t;n++)o+=(100*i[n++]|0)/100+","+(100*i[n++]|0)/100+" "+(100*i[n++]|0)/100+","+(100*i[n++]|0)/100+" "+(100*i[n++]|0)/100+","+(100*i[n]|0)/100+" ";i.closed&&(o+="z")}return o},_reverseBezier=function(e){for(var t=[],r=e.length-1,n=0;--r>-1;)t[n++]=e[r],t[n++]=e[r+1],r--;for(r=0;r<n;r++)e[r]=t[r];e.reversed=!e.reversed},_getAverageXY=function(e){var t,r=e.length,n=0,i=0;for(t=0;t<r;t++)n+=e[t++],i+=e[t];return[n/(r/2),i/(r/2)]},_getSize=function(e){var t,r,n,i=e.length,o=e[0],a=o,s=e[1],l=s;for(n=6;n<i;n+=6)t=e[n],r=e[n+1],t>o?o=t:t<a&&(a=t),r>s?s=r:r<l&&(l=r);return e.centerX=(o+a)/2,e.centerY=(s+l)/2,e.size=(o-a)*(s-l)},_getTotalSize=function(e){for(var t,r,n,i,o,a=e.length,s=e[0][0],l=s,h=e[0][1],g=h;--a>-1;)for(t=(o=e[a]).length,i=6;i<t;i+=6)r=o[i],n=o[i+1],r>s?s=r:r<l&&(l=r),n>h?h=n:n<g&&(g=n);return e.centerX=(s+l)/2,e.centerY=(h+g)/2,e.size=(s-l)*(h-g)},_sortByComplexity=function(e,t){return t.length-e.length},_sortBySize=function(e,t){var r=e.size||_getSize(e),n=t.size||_getSize(t);return Math.abs(n-r)<(r+n)/20?t.centerX-e.centerX||t.centerY-e.centerY:n-r},_offsetBezier=function(e,t){var r,n,i=e.slice(0),o=e.length,a=o-2;for(t|=0,r=0;r<o;r++)n=(r+t)%a,e[r++]=i[n],e[r]=i[n+1]},_getTotalMovement=function(e,t,r,n,i){var o,a,s,l,h=e.length,g=0,u=h-2;for(r*=6,a=0;a<h;a+=6)l=e[o=(a+r)%u]-(t[a]-n),s=e[o+1]-(t[a+1]-i),g+=Math.sqrt(s*s+l*l);return g},_getClosestShapeIndex=function(e,t,r){var n,i,o,a=e.length,s=_getAverageXY(e),l=_getAverageXY(t),h=l[0]-s[0],g=l[1]-s[1],u=_getTotalMovement(e,t,0,h,g),p=0;for(o=6;o<a;o+=6)(i=_getTotalMovement(e,t,o/6,h,g))<u&&(u=i,p=o);if(r)for(n=e.slice(0),_reverseBezier(n),o=6;o<a;o+=6)(i=_getTotalMovement(n,t,o/6,h,g))<u&&(u=i,p=-o);return p/6},_getClosestAnchor=function(e,t,r){for(var n,i,o,a,s,l,h=e.length,g=99999999999,u=0,p=0;--h>-1;)for(l=(n=e[h]).length,s=0;s<l;s+=6)i=n[s]-t,o=n[s+1]-r,(a=Math.sqrt(i*i+o*o))<g&&(g=a,u=n[s],p=n[s+1]);return[u,p]},_getClosestSegment=function(e,t,r,n,i,o){var a,s,l,h,g=t.length,u=0,p=Math.min(e.size||_getSize(e),t[r].size||_getSize(t[r]))*n,c=999999999999,f=e.centerX+i,_=e.centerY+o;for(a=r;a<g&&!((t[a].size||_getSize(t[a]))<p);a++)s=t[a].centerX-f,l=t[a].centerY-_,(h=Math.sqrt(s*s+l*l))<c&&(u=a,c=h);return h=t[u],t.splice(u,1),h},_equalizeSegmentQuantity=function(e,t,r,n){var i,o,a,s,l,h,g,u=t.length-e.length,p=u>0?t:e,c=u>0?e:t,f=0,_="complexity"===n?_sortByComplexity:_sortBySize,d="position"===n?0:"number"==typeof n?n:.8,v=c.length,z="object"==typeof r&&r.push?r.slice(0):[r],b="reverse"===z[0]||z[0]<0,M="log"===r;if(c[0]){if(p.length>1&&(e.sort(_),t.sort(_),h=p.size||_getTotalSize(p),h=c.size||_getTotalSize(c),h=p.centerX-c.centerX,g=p.centerY-c.centerY,_===_sortBySize))for(v=0;v<c.length;v++)p.splice(v,0,_getClosestSegment(c[v],p,v,d,h,g));if(u)for(u<0&&(u=-u),p[0].length>c[0].length&&_subdivideBezier(c[0],(p[0].length-c[0].length)/6|0),v=c.length;f<u;)s=p[v].size||_getSize(p[v]),s=(a=_getClosestAnchor(c,p[v].centerX,p[v].centerY))[0],l=a[1],c[v++]=[s,l,s,l,s,l,s,l],c.totalPoints+=8,f++;for(v=0;v<e.length;v++)i=t[v],o=e[v],(u=i.length-o.length)<0?_subdivideBezier(i,-u/6|0):u>0&&_subdivideBezier(o,u/6|0),b&&!o.reversed&&_reverseBezier(o),(r=z[v]||0===z[v]?z[v]:"auto")&&(o.closed||Math.abs(o[0]-o[o.length-2])<.5&&Math.abs(o[1]-o[o.length-1])<.5?"auto"===r||"log"===r?(z[v]=r=_getClosestShapeIndex(o,i,0===v),r<0&&(b=!0,_reverseBezier(o),r=-r),_offsetBezier(o,6*r)):"reverse"!==r&&(v&&r<0&&_reverseBezier(o),_offsetBezier(o,6*(r<0?-r:r))):!b&&("auto"===r&&Math.abs(i[0]-o[0])+Math.abs(i[1]-o[1])+Math.abs(i[i.length-2]-o[o.length-2])+Math.abs(i[i.length-1]-o[o.length-1])>Math.abs(i[0]-o[o.length-2])+Math.abs(i[1]-o[o.length-1])+Math.abs(i[i.length-2]-o[0])+Math.abs(i[i.length-1]-o[1])||r%2)?(_reverseBezier(o),z[v]=-1,b=!0):"auto"===r?z[v]=0:"reverse"===r&&(z[v]=-1),o.closed!==i.closed&&(o.closed=i.closed=!1));return M&&_log("shapeIndex:["+z.join(",")+"]"),z}},_pathFilter=function(e,t,r,n){var i=_pathDataToBezier(e[0]),o=_pathDataToBezier(e[1]);_equalizeSegmentQuantity(i,o,t||0===t?t:"auto",r)&&(e[0]=_bezierToPathData(i),e[1]=_bezierToPathData(o),"log"!==n&&!0!==n||_log('precompile:["'+e[0]+'","'+e[1]+'"]'))},_buildPathFilter=function(e,t,r){return t||r||e||0===e?function(n){_pathFilter(n,e,t,r)}:_pathFilter},_offsetPoints=function(e,t){if(!t)return e;var r,n,i,o=e.match(_numbersExp)||[],a=o.length,s="";for("reverse"===t?(n=a-1,r=-2):(n=(2*(parseInt(t,10)||0)+1+100*a)%a,r=2),i=0;i<a;i+=2)s+=o[n-1]+","+o[n]+" ",n=(n+r)%a;return s},_equalizePointQuantity=function(e,t){var r,n,i,o,a,s,l,h=0,g=parseFloat(e[0]),u=parseFloat(e[1]),p=g+","+u+" ";for(r=.5*t/(.5*(i=e.length)-1),n=0;n<i-2;n+=2){if(h+=r,s=parseFloat(e[n+2]),l=parseFloat(e[n+3]),h>.999999)for(a=1/(Math.floor(h)+1),o=1;h>.999999;)p+=(g+(s-g)*a*o).toFixed(2)+","+(u+(l-u)*a*o).toFixed(2)+" ",h--,o++;p+=s+","+l+" ",g=s,u=l}return p},_pointsFilter=function(e){var t=e[0].match(_numbersExp)||[],r=e[1].match(_numbersExp)||[],n=r.length-t.length;n>0?e[0]=_equalizePointQuantity(t,n):e[1]=_equalizePointQuantity(r,-n)},_buildPointsFilter=function(e){return isNaN(e)?_pointsFilter:function(t){_pointsFilter(t),t[1]=_offsetPoints(t[1],parseInt(e,10))}},_createPath=function(e,t){var r,n=_gsScope.document.createElementNS("http://www.w3.org/2000/svg","path"),i=Array.prototype.slice.call(e.attributes),o=i.length;for(t=","+t+",";--o>-1;)r=i[o].nodeName.toLowerCase(),-1===t.indexOf(","+r+",")&&n.setAttributeNS(null,r,i[o].nodeValue);return n},_convertToPath=function(e,t){var r,n,i,o,a,s,l,h,g,u,p,c,f,_,d,v,z,b,M,m,S,A=e.tagName.toLowerCase(),P=.552284749831;return"path"!==A&&e.getBBox?(s=_createPath(e,"x,y,width,height,cx,cy,rx,ry,r,x1,x2,y1,y2,points"),"rect"===A?(o=+e.getAttribute("rx")||0,a=+e.getAttribute("ry")||0,n=+e.getAttribute("x")||0,i=+e.getAttribute("y")||0,u=(+e.getAttribute("width")||0)-2*o,p=(+e.getAttribute("height")||0)-2*a,r=o||a?"M"+(v=(_=(f=n+o)+u)+o)+","+(b=i+a)+" V"+(M=b+p)+" C"+[v,m=M+a*P,d=_+o*P,S=M+a,_,S,_-(_-f)/3,S,f+(_-f)/3,S,f,S,c=n+o*(1-P),S,n,m,n,M,n,M-(M-b)/3,n,b+(M-b)/3,n,b,n,z=i+a*(1-P),c,i,f,i,f+(_-f)/3,i,_-(_-f)/3,i,_,i,d,i,v,z,v,b].join(",")+"z":"M"+(n+u)+","+i+" v"+p+" h"+-u+" v"+-p+" h"+u+"z"):"circle"===A||"ellipse"===A?("circle"===A?h=(o=a=+e.getAttribute("r")||0)*P:(o=+e.getAttribute("rx")||0,h=(a=+e.getAttribute("ry")||0)*P),r="M"+((n=+e.getAttribute("cx")||0)+o)+","+(i=+e.getAttribute("cy")||0)+" C"+[n+o,i+h,n+(l=o*P),i+a,n,i+a,n-l,i+a,n-o,i+h,n-o,i,n-o,i-h,n-l,i-a,n,i-a,n+l,i-a,n+o,i-h,n+o,i].join(",")+"z"):"line"===A?r=_bezierToPathData(_pathDataToBezier("M"+(e.getAttribute("x1")||0)+","+(e.getAttribute("y1")||0)+" L"+(e.getAttribute("x2")||0)+","+(e.getAttribute("y2")||0))):"polyline"!==A&&"polygon"!==A||(r="M"+(n=(g=(e.getAttribute("points")+"").match(_numbersExp)||[]).shift())+","+(i=g.shift())+" L"+g.join(","),"polygon"===A&&(r+=","+n+","+i+"z")),s.setAttribute("d",r),t&&e.parentNode&&(e.parentNode.insertBefore(s,e),e.parentNode.removeChild(e)),s):e},_parseShape=function(e,t,r){var n,i,o="string"==typeof e;return(!o||_selectorExp.test(e)||(e.match(_numbersExp)||[]).length<3)&&((n=o?TweenLite.selector(e):e&&e[0]?e:[e])&&n[0]?(i=(n=n[0]).nodeName.toUpperCase(),t&&"PATH"!==i&&(n=_convertToPath(n,!1),i="PATH"),e=n.getAttribute("PATH"===i?"d":"points")||"",n===r&&(e=n.getAttributeNS(null,"data-original")||e)):(_log("WARNING: invalid morph to: "+e),e=!1)),e},_morphMessage="Use MorphSVGPlugin.convertToPath(elementOrSelectorText) to convert to a path before morphing.",MorphSVGPlugin=_gsScope._gsDefine.plugin({propName:"morphSVG",API:2,global:!0,version:"0.8.11",init:function(e,t,r,n){var i,o,a,s,l;return"function"==typeof e.setAttribute&&("function"==typeof t&&(t=t(n,e)),l="POLYLINE"===(i=e.nodeName.toUpperCase())||"POLYGON"===i,"PATH"===i||l?(o="PATH"===i?"d":"points",("string"==typeof t||t.getBBox||t[0])&&(t={shape:t}),s=_parseShape(t.shape||t.d||t.points||"","d"===o,e),l&&_commands.test(s)?(_log("WARNING: a <"+i+"> cannot accept path data. "+_morphMessage),!1):(s&&(this._target=e,e.getAttributeNS(null,"data-original")||e.setAttributeNS(null,"data-original",e.getAttribute(o)),(a=this._addTween(e,"setAttribute",e.getAttribute(o)+"",s+"","morphSVG",!1,o,"object"==typeof t.precompile?function(e){e[0]=t.precompile[0],e[1]=t.precompile[1]}:"d"===o?_buildPathFilter(t.shapeIndex,t.map||MorphSVGPlugin.defaultMap,t.precompile):_buildPointsFilter(t.shapeIndex)))&&(this._overwriteProps.push("morphSVG"),a.end=s,a.endProp=o)),!0)):(_log("WARNING: cannot morph a <"+i+"> SVG element. "+_morphMessage),!1))},set:function(e){var t;if(this._super.setRatio.call(this,e),1===e)for(t=this._firstPT;t;)t.end&&this._target.setAttribute(t.endProp,t.end),t=t._next}});MorphSVGPlugin.pathFilter=_pathFilter,MorphSVGPlugin.pointsFilter=_pointsFilter,MorphSVGPlugin.subdivideRawBezier=_subdivideBezier,MorphSVGPlugin.defaultMap="size",MorphSVGPlugin.pathDataToRawBezier=function(e){return _pathDataToBezier(_parseShape(e,!0))},MorphSVGPlugin.equalizeSegmentQuantity=_equalizeSegmentQuantity,MorphSVGPlugin.convertToPath=function(e,t){"string"==typeof e&&(e=TweenLite.selector(e));for(var r=e&&0!==e.length?e.length&&e[0]&&e[0].nodeType?Array.prototype.slice.call(e,0):[e]:[],n=r.length;--n>-1;)r[n]=_convertToPath(r[n],!1!==t);return r},MorphSVGPlugin.pathDataToBezier=function(e,t){var r,n,i,o,a,s,l,h,g=_pathDataToBezier(_parseShape(e,!0))[0]||[],u=0;if(h=(t=t||{}).align||t.relative,o=t.matrix||[1,0,0,1,0,0],a=t.offsetX||0,s=t.offsetY||0,"relative"===h||!0===h?(a-=g[0]*o[0]+g[1]*o[2],s-=g[0]*o[1]+g[1]*o[3],u="+="):(a+=o[4],s+=o[5],h&&(h="string"==typeof h?TweenLite.selector(h):h&&h[0]?h:[h])&&h[0]&&(a-=(l=h[0].getBBox()||{x:0,y:0}).x,s-=l.y)),r=[],i=g.length,o&&"1,0,0,1,0,0"!==o.join(","))for(n=0;n<i;n+=2)r.push({x:u+(g[n]*o[0]+g[n+1]*o[2]+a),y:u+(g[n]*o[1]+g[n+1]*o[3]+s)});else for(n=0;n<i;n+=2)r.push({x:u+(g[n]+a),y:u+(g[n+1]+s)});return r};export{MorphSVGPlugin,MorphSVGPlugin as default};
